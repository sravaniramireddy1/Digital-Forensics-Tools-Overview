
# **Ex.No.10 — Use Ghidra to Disassemble and Analyze Malware Code**

**📚 Course / Lab:** Digital Forensics Lab

**🧾 Experiment No:** 10

**📝 Title:** Use Ghidra to Disassemble and Analyze Malware Code

**📅 Date:** : 27-10-2025

**🆔 Reg No:** 99230040849

---

## 📘 **Description**

**Ghidra** is an open-source reverse engineering framework developed by the **U.S. National Security Agency (NSA)**.
It is widely used for **disassembling, decompiling, and analyzing executable files** to understand their internal operations and detect possible malicious behavior.
This experiment demonstrates how Ghidra can be used to analyze **malware or suspicious binaries** in a safe and controlled environment.

---

## 🎯 **Objectives**

* 🔍 Understand how to disassemble and analyze binary executables using Ghidra.
* 🧠 Identify **malware behaviors** such as persistence, obfuscation, or network communication.
* ⚙️ Learn to interpret **assembly and decompiled code** to understand program functionality.
* 🧩 Explore how to automate analysis using **Python or Java scripting** in Ghidra.

---

## ⚙️ **Requirements**

* 🖥️ System with Windows/Linux/macOS
* ☕ **Java Runtime Environment (JRE)** installed
* 🧰 **Ghidra** (latest version) downloaded from [https://ghidra-sre.org](https://ghidra-sre.org)
* 🔒 **Virtual Machine (VM)** setup for safe malware testing
* 🧱 **Sample binary file** (benign or dummy malware sample)

---

## 🪜 **Step-by-Step Process**

### 🔹 Step 1: Environment Setup

**🎯 Purpose:** Prepare a secure and isolated setup for reverse engineering.

**📋 Instructions:**

1. Install **Ghidra** on the host system.
2. Create a **Virtual Machine** using tools like **VirtualBox** or **VMware**.
3. Disable network connectivity inside the VM for safety.
4. Place the sample binary file inside the VM for analysis.

---

### 🔹 Step 2: Launch Ghidra and Create a New Project

1. Open **Ghidra** and select **File → New Project**.
2. Choose **Non-Shared Project**, name it (e.g., `Malware_Analysis`).
3. Import the binary file using **File → Import File**.
4. Ghidra will automatically detect the file type (EXE, ELF, etc.) and format it for analysis.

<details>
<summary>📸 View Project Setup Example</summary>
<br>
<p align="center">
  <img width="700" alt="Ghidra project setup" src="https://github.com/baddiputi/Digital-Forensic-Lab-Exercises/blob/main/images/10.1.png" />
</p>
</details>

---

### 🔹 Step 3: Perform Auto Analysis

**🎯 Purpose:** Allow Ghidra to automatically detect functions and code patterns.

1. Right-click the imported binary → **Analyze**.
2. In the dialog box, check **Auto Analysis** and press **Yes**.
3. Ghidra disassembles and decompiles the binary, showing assembly and high-level code side by side.

---

### 🔹 Step 4: Examine Functions and Code Flow

1. Open the **Listing Window** to view assembly instructions.
2. Use the **Decompiler Window** to see C-like pseudocode.
3. Navigate to `main()` or entry point using **Symbol Tree**.
4. Observe:

   * Function calls and variable names
   * Conditional branches and loops
   * Suspicious patterns like file access or network calls

<details>
<summary>🧩 View Decompiled Code Example</summary>
<br>
<p align="center">
  <img width="700" alt="Decompiler view example" src="https://github.com/baddiputi/Digital-Forensic-Lab-Exercises/blob/main/images/10.2.png" />
</p>
</details>

---

### 🔹 Step 5: Analyze Strings and Imports

1. Open **Window → Defined Strings** to view readable text inside the binary.
2. Look for keywords like `"http"`, `"socket"`, `"cmd"`, `"password"`, or `"registry"`.
3. Open **Imports Window** to see which system libraries are used.
4. Check for suspicious imports such as:

   * `CreateProcessA`, `ShellExecuteA` → Execution
   * `InternetOpenUrlA`, `WSAStartup` → Network
   * `RegSetValueA` → Persistence

---

### 🔹 Step 6: Identify Suspicious Behavior

* 🧬 Check **control flow graphs** to trace code execution.
* 🔁 Identify **loops or functions** used repeatedly (may indicate encryption or packing).
* 🧱 Observe anti-analysis tricks like dynamic loading or obfuscation.
* 💻 Use **Comments** feature in Ghidra to annotate findings.

<details>
<summary>🔍 View Control Flow Graph</summary>
<br>
<p align="center">
  <img width="700" alt="Control flow graph" src="https://github.com/baddiputi/Digital-Forensic-Lab-Exercises/blob/main/images/10.3.png" />
</p>
</details>

---

### 🔹 Step 7: Automate Analysis with Scripts

**📜 Example Python Script — Extract All Strings**

```python
from ghidra.program.model.symbol import SymbolType

for s in currentProgram.getSymbolTable().getAllSymbols(True):
    if s.getSymbolType() == SymbolType.LABEL:
        print(s.getName())
```

**🎯 Purpose:** Automates repetitive analysis tasks and saves time.
Scripts can also:

* Detect function names related to networking
* Tag known malware functions
* Export data for reporting

---

### 🔹 Step 8: Document Findings

Prepare a structured report containing:

* 🧩 **Overview:** Type of file and analysis summary
* 🔍 **Function Analysis:** Key functions and their behavior
* 🌐 **Network Indicators:** URLs, IPs, or domains found
* 🔒 **Persistence Techniques:** Registry edits or autorun entries
* 🧠 **Conclusion:** Summary of malware functionality and threat level

---

## ✅ **Result**

The malware code was successfully analyzed using **Ghidra**.
The experiment demonstrated how to disassemble a binary, interpret assembly code, view decompiled functions, and identify potential malicious behaviors.
Ghidra proved to be a powerful static analysis tool for understanding malware operations in a secure environment.

🎯 **Key Outcomes:**

* ✅ Setup of a safe and isolated analysis environment
* ✅ Successful import and disassembly of the binary file
* ✅ Identified important functions, imports, and strings
* ✅ Documented malware behaviors like persistence and communication
* ✅ Used Python automation for deeper analysis

---

## 📝 **Notes**

⚠️ **Safety Precaution:** Always analyze unknown binaries in an isolated virtual machine with no internet access. 

🔒 **Legal Compliance:** Reverse engineering should only be performed on authorized or educational samples.

🧠 **Documentation:** Maintain a detailed record of analysis steps and findings.

💡 **Tip:** Use Ghidra’s “Bookmarks” and “Comments” to track important sections of code.

📘 **Further Study:** Learn advanced Ghidra scripting and P-Code emulation for runtime analysis.

---

## 💡 **Future Enhancements**

* ⚙️ Add more automation scripts for bulk analysis.
* 🧩 Include examples of obfuscated binaries.
* 🌍 Build a collaborative repository for Ghidra script sharing.
* 🔬 Explore dynamic malware analysis with Ghidra’s **P-Code emulator**.

